var module;define("icybee/thumbnailer/version",[],function(){function t(t){let e={},n=t,o=t.indexOf("?");if(o>-1){n=t.substring(0,o);let s=t.substring(o+1);e=String.parseQueryString(s),e=i.widen(e)}e=Object.merge({width:null,height:null,method:null,format:null},e);const s=n.match(/\/?(\d+x\d+|\d+x|x\d+)(\/([^\/\.]+))?(\.([a-z]+))?/);if(s){const t=s[1].split("x"),n=t[0],i=t[1];n&&(e.width=parseInt(n)),i&&(e.height=parseInt(i)),s[3]&&(e.method=s[3]),s[5]&&(e.format=s[5]),e.format&&"jpg"==e.format&&(e.format="jpeg")}return Object.filter(e,function(t,e){return!!t})}const e={background:null,default:null,filter:null,format:null,height:null,method:"fill","no-interlace":!1,"no-upscale":!1,overlay:null,path:null,quality:90,src:null,width:null},n={b:"background",d:"default",ft:"filter",f:"format",h:"height",m:"method",ni:"no-interlace",nu:"no-upscale",o:"overlay",p:"path",q:"quality",s:"src",v:"version",w:"width"},i=class{constructor(t){this.options=Object.assign({},e,this.widen(t))}toString(){return this.serialize(this.options)}get background(){return this.options.background}set background(t){this.options.background=t}get default(){return this.options.default}set default(t){this.options.default=t}get filter(){return this.options.filter}set filter(t){this.options.filter=t}get format(){return this.options.format}set format(t){this.options.format=t}get height(){return this.options.height}set height(t){this.options.height=t}get method(){return this.options.method}set method(t){this.options.method=t}get noInterlace(){return this.options.noInterlace}set noInterlace(t){this.options.noInterlace=t}get noUpscale(){return this.options.noUpscale}set noUpscale(t){this.options.noUpscale=t}get overlay(){return this.options.overlay}set overlay(t){this.options.overlay=t}get path(){return this.options.path}set path(t){this.options.path=t}get quality(){return this.options.quality}set quality(t){this.options.quality=t}get src(){return this.options.src}set src(t){this.options.src=t}get version(){return this.options.version}set version(t){this.options.version=t}get width(){return this.options.width}set width(t){this.options.width=t}static widen(t){const e={};Object.each(t,((t,i)=>{if(i in n){i=n[i]}e[i]=t}));return e}static shorten(t){const e={};Object.each(t,((t,i)=>{var o=Object.keyOf(n,i);if(o){i=o}e[i]=t}));return e}static normalize(t){const i=e;const o=Object.keys(i);const s=n;const c=Object.clone(i);Object.each(t,((t,e)=>{if(!t){return}if(s[e]){e=s[e]}c[e]=t}));let r="method"in c?c["method"]:null;let u="width"in c?c["width"]:null;let h="height"in c?c["height"]:null;if(u&&h&&!r)r="fill";else if(u&&!h)r="fixed-width";else if(!u&&h)r="fixed-height";if(r)c["method"]=r;else delete c["method"];return Object.filter(c,((t,e)=>{return Object.contains(o,e)}))}static filter(t){const n=e;const i=this.normalize(t);const o="width"in i?i["width"]:null;const s="height"in i?i["height"]:null;const c="method"in i?i["method"]:null;if(o&&s&&c==="fill"||o&&!s&&c==="fixed-width"||!o&&s&&c==="fixed-height"){delete i["method"]}return Object.filter(i,((t,e)=>{return t&&t!=n[e]}))}static serialize(t){t=this.filter(t);t=this.shorten(t);t=Object.merge({w:"",h:"",m:null,f:null},t);const e=t.w;const n=t.h;const i=t.m;const o=t.f;let s="";if(e||n){s=e+"x"+n;if(i)s+="/"+i;if(o)s+="."+o}delete t["w"];delete t["h"];delete t["m"];delete t["f"];const c=Object.toQueryString(t);if(c){s+="?"+c}return s}static unserialize(e){let n=t(e);return this.filter(n)}};return i.defaults=e,i.shorthands=n,i}),define("icybee/thumbnailer/thumbnail",["icybee/thumbnailer/version"],function(t){return class{constructor(t,e){this.src=t;this.options=e}toString(){const e=this.src;const n=e.match(/repository\/files\/image\/(\d+)/)||e.match(/images\/(\d+|[a-z0-9\-]{36})/);let i=this.options;let o="/api/thumbnail";if(typeOf(i)==="string"){i=t.unserialize(i)}if(n){o="/images/"+n[1]}else{i=Object.merge({src:e},i)}return o+"/"+t.serialize(i)}}}),define("icybee/thumbnailer",["icybee/thumbnailer/version","icybee/thumbnailer/thumbnail"],function(t,e){var n=new function(){this.RESIZE_NONE="none",this.RESIZE_FIT="fit",this.RESIZE_FILL="fill",this.RESIZE_FIXED_HEIGHT="fixed-height",this.RESIZE_FIXED_HEIGHT_CROPPED="fixed-height-cropped",this.RESIZE_FIXED_WIDTH="fixed-width",this.RESIZE_FIXED_WIDTH_CROPPED="fixed-width-cropped",this.RESIZE_SURFACE="surface",this.RESIZE_SIMPLE="simple",this.RESIZE_CONSTRAINED="constrained",this.assertSize=function(t,e,n){switch(n){case this.RESIZE_FIXED_WIDTH:if(!t)throw new Error("Width is required for the "+n+" resize method.");break;case this.RESIZE_FIXED_HEIGHT:if(!e)throw new Error("Height is required for the "+n+" resize method.");break;default:if(!t||!e)throw new Error("Both width and height are required for the "+n+" resize method.")}return!0}};return ICanBoogie.Modules.Thumbnailer={Image:n,Thumbnail:e,Version:t}}),!function(t){"use strict";const e=ICanBoogie.Modules.Thumbnailer.Version;e.defaults.lightbox=null,e.shorthands.lb="lightbox";const n=new Class({Implements:[Events],initialize:function(t){this.element=t,this.controls={},Object.each(e.defaults,function(e,n){const i=t.querySelector('[name="'+n+'"]');i&&(this[n]=i)},this.controls),t.addEvent("change",this.onChange.bind(this)),this.checkMethod(),this.checkQuality()},checkMethod:function(){const t=this.controls.height,e=this.controls.width;switch(this.controls.method.get("value")){case"fixed-height":t.readOnly=!1,e.readOnly=!0;break;case"fixed-width":t.readOnly=!0,e.readOnly=!1;break;default:e.readOnly=!1,t.readOnly=!1}},checkQuality:function(){const t=this.controls.format.get("value");this.controls.quality.setStyle("display","jpeg"!=t?"none":""),this.controls.quality.previousSibling.setStyle("display","jpeg"!=t?"none":"")},getValue:function(){const t=this.element.toQueryString().parseQueryString();return this.controls.width.readOnly&&delete t.width,this.controls.height.readOnly&&delete t.height,t},setValue:function(t){Object.each(e.normalize(t),function(t,e){var n=this[e];n&&("checkbox"==n.type?n.set("checked",!!t):n.set("value",t))},this.controls),this.checkMethod(),this.checkQuality()},onChange:function(t){this.checkMethod(),this.checkQuality(),this.fireEvent("change",{target:this,values:this.getValue()})}});t.register("AdjustThumbnailOptions",((t,e)=>{return new n(t,e)}))}(Brickrouge),define("icybee/thumbnailer/adjust-thumbnail-version",["brickrouge","icybee/adjust","icybee/thumbnailer/version"],function(t,e,n){const i=class extends e{constructor(t,e){super();this.element=t;this.options=e;const n=t.querySelector('input[name="width"]')||t.querySelector('input[name$="[width]"]');const i=t.querySelector('input[name="height"]')||t.querySelector('input[name$="[height]"]');const o=t.querySelector('select[name="method"]')||t.querySelector('select[name$="[method]"]');const s=t.querySelector('select[name="format"]')||t.querySelector('select[name$="[format]"]');const c=t.querySelector('input[name="quality"]')||t.querySelector('input[name$="[quality]"]');this.elements={width:n,height:i,method:o,format:s,quality:c,"no-upscale":t.querySelector('input[name="no-upscale"]')||t.querySelector('input[name$="[no-upscale]"]'),background:t.querySelector('input[name="background"]')||t.querySelector('input[name$="[background]"]'),filter:t.querySelector('input[name="filter"]')||t.querySelector('input[name$="[filter]"]')};Object.each(this.elements,(t=>{if(!t)return;t.addEventListener("change",this.notifyChange.bind(this))}));function r(){switch(o.value){case"fixed-height":i.readOnly=false;n.readOnly=true;break;case"fixed-width":i.readOnly=true;n.readOnly=false;break;default:i.readOnly=false;n.readOnly=false;break}}function u(){const t=s.value}r();u();o.addEventListener("change",r);s.addEventListener("change",u)}notifyChange(){this.notify(new e.ChangeEvent(this,this.value))}get value(){const t=this.element.toQueryString().parseQueryString();return n.serialize(t)}set value(t){const e=n.normalize(n.unserialize(t));Object.each(e,((t,e)=>{if(!(e in this.elements)){return}if(e=="no-upscale"||e=="no-interlace"){this.elements[e].checked=t}else{this.elements[e].value=t}}))}};t.register("AdjustThumbnailVersion",((t,e)=>{return new i(t,e)}))}),define("icybee/thumbnailer/pop-thumbnail-version",["icybee/spinner","icybee/adjust-popover"],function(t,e){const n="adjust-thumbnail-version/popup";return class extends t{createPopover(t){new Request.Widget(n,(n=>{t(new e(n,{anchor:this.element}))})).get({value:this.value})}}}),!function(t){let e;t.register("PopThumbnailVersion",((t,n)=>{return e||(e=require("icybee/thumbnailer/pop-thumbnail-version")),new e(t,n)}))}(Brickrouge);
//# sourceMappingURL=public/module.js.map
