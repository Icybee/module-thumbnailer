!function(){var e=new function(){this.RESIZE_NONE="none",this.RESIZE_FIT="fit",this.RESIZE_FILL="fill",this.RESIZE_FIXED_HEIGHT="fixed-height",this.RESIZE_FIXED_HEIGHT_CROPPED="fixed-height-cropped",this.RESIZE_FIXED_WIDTH="fixed-width",this.RESIZE_FIXED_WIDTH_CROPPED="fixed-width-cropped",this.RESIZE_SURFACE="surface",this.RESIZE_SIMPLE="simple",this.RESIZE_CONSTRAINED="constrained",this.assertSize=function(e,t,n){switch(n){case this.RESIZE_FIXED_WIDTH:if(!e)throw new Error("Width is required for the "+n+" resize method.");break;case this.RESIZE_FIXED_HEIGHT:if(!t)throw new Error("Height is required for the "+n+" resize method.");break;default:if(!e||!t)throw new Error("Both width and height are required for the "+n+" resize method.")}return!0}},t=function(){function e(e){var t={},n=e,o=e.indexOf("?");if(o>-1){n=e.substring(0,o);var r=e.substring(o+1);t=String.parseQueryString(r),t=i.widen(t)}t=Object.merge({width:null,height:null,method:null,format:null},t);var l=n.match(/\/?(\d+x\d+|\d+x|x\d+)(\/([^\/\.]+))?(\.([a-z]+))?/);if(l){var a=l[1].split("x"),h=a[0],s=a[1];h&&(t.width=parseInt(h)),s&&(t.height=parseInt(s)),l[3]&&(t.method=l[3]),l[5]&&(t.format=l[5]),t.format&&"jpg"==t.format&&(t.format="jpeg")}return Object.filter(t,function(e){return!!e})}var t={background:null,"default":null,filter:null,format:null,height:null,method:"fill","no-interlace":!1,"no-upscale":!1,overlay:null,path:null,quality:90,src:null,width:null},n={b:"background",d:"default",ft:"filter",f:"format",h:"height",m:"method",ni:"no-interlace",nu:"no-upscale",o:"overlay",p:"path",q:"quality",s:"src",v:"version",w:"width"},i=function(e){this.options=e};return i.prototype={toString:function(){return i.serialize(this.options)}},i.defaults=t,i.shorthands=n,i.widen=function(e){var t={},i=n;return Object.each(e,function(e,n){n in i&&(n=i[n]),t[n]=e}),t},i.shorten=function(e){var t={};return Object.each(e,function(e,i){var o=Object.keyOf(n,i);o&&(i=o),t[i]=e}),t},i.normalize=function(e){var i=t,o=Object.keys(i),r=n,l=Object.clone(i);Object.each(e,function(e,t){e&&(r[t]&&(t=r[t]),l[t]=e)});var a="method"in l?l.method:null,h="width"in l?l.width:null,s="height"in l?l.height:null;return h&&s&&!a?a="fill":h&&!s?a="fixed-width":!h&&s&&(a="fixed-height"),a?l.method=a:delete l.method,Object.filter(l,function(e,t){return Object.contains(o,t)})},i.filter=function(e){var n=t,o=(Object.keys(n),i.normalize(e)),r="width"in o?o.width:null,l="height"in o?o.height:null,a="method"in o?o.method:null;return(r&&l&&"fill"===a||r&&!l&&"fixed-width"===a||!r&&l&&"fixed-height"===a)&&delete o.method,Object.filter(o,function(e,t){return e&&e!=n[t]})},i.serialize=function(e){e=i.filter(e),e=i.shorten(e),e=Object.merge({w:"",h:"",m:null,f:null},e);var t="",n=e.w,o=e.h,r=e.m,l=e.f;(n||o)&&(t=n+"x"+o,r&&(t+="/"+r),l&&(t+="."+l)),delete e.w,delete e.h,delete e.m,delete e.f;var a=Object.toQueryString(e);return a&&(t+="?"+a),t},i.unserialize=function(t){return options=e(t),options=i.filter(options)},i}(),n=new Class({options:{},initialize:function(e,t){this.src=e,this.options=t},toString:function(){var e=t.serialize(this.options);return console.log("Thumbnailer.toString:",e),e}}),i={Image:e,Thumbnail:n,Version:t};try{module.exports=i}catch(o){ICanBoogie.Modules.Thumbnailer=i}}(),Brickrouge.Widget.AdjustThumbnailOptions=function(){var e=ICanBoogie.Modules.Thumbnailer.Version;return e.defaults.lightbox=null,e.shorthands.lb="lightbox",new Class({Implements:[Events],initialize:function(t){this.element=t=document.id(t),this.controls={},Object.each(e.defaults,function(e,n){var i=t.getElement('[name="'+n+'"]');i&&(this[n]=i)},this.controls),t.addEvent("change",this.onChange.bind(this)),this.checkMethod(),this.checkQuality()},checkMethod:function(){var e=this.controls.height,t=this.controls.width;switch(this.controls.method.get("value")){case"fixed-height":e.readOnly=!1,t.readOnly=!0;break;case"fixed-width":e.readOnly=!0,t.readOnly=!1;break;default:t.readOnly=!1,e.readOnly=!1}},checkQuality:function(){var e=this.controls.format.get("value");this.controls.quality.getParent().setStyle("display","jpeg"!=e?"none":"")},getValue:function(){var e=this.element.toQueryString().parseQueryString();return this.controls.width.readOnly&&delete e.width,this.controls.height.readOnly&&delete e.height,e},setValue:function(t){Object.each(e.normalize(t),function(e,t){var n=this[t];n&&("checkbox"==n.type?n.set("checked",!!e):n.set("value",e))},this.controls),this.checkMethod(),this.checkQuality()},onChange:function(){this.checkMethod(),this.checkQuality(),this.fireEvent("change",{target:this,values:this.getValue()})}})}(),!function(){var e=ICanBoogie.Modules.Thumbnailer.Version;Brickrouge.Widget.AdjustThumbnailVersion=new Class({Implements:[Options,Events],initialize:function(e){function t(){switch(r.get("value")){case"fixed-height":o.readOnly=!1,i.readOnly=!0;break;case"fixed-width":o.readOnly=!0,i.readOnly=!1;break;default:o.readOnly=!1,i.readOnly=!1}}function n(){var e=l.get("value");a.getParent().setStyle("display","jpeg"!=e?"none":"")}this.element=e=document.id(e);var i=e.getElement('input[name="width"]')||e.getElement('input[name$="[width]"]'),o=e.getElement('input[name="height"]')||e.getElement('input[name$="[height]"]'),r=e.getElement('select[name="method"]')||e.getElement('select[name$="[method]"]'),l=e.getElement('select[name="format"]')||e.getElement('select[name$="[format]"]'),a=e.getElement('input[name="quality"]')||e.getElement('input[name$="[quality]"]');this.elements={width:i,height:o,method:r,format:l,quality:a,"no-upscale":e.getElement('input[name="no-upscale"]')||e.getElement('input[name$="[no-upscale]"]'),background:e.getElement('input[name="background"]')||e.getElement('input[name$="[background]"]'),filter:e.getElement('input[name="filter"]')||e.getElement('input[name$="[filter]"]')},Object.each(this.elements,function(e){e&&e.addEvent("change",this.fireChange.bind(this))},this),t(),n(),r.addEvent("change",t),l.addEvent("change",n)},fireChange:function(){},setValue:function(t){var n=e.normalize(e.unserialize(t));Object.each(n,function(e,t){this.elements[t]&&("no-upscale"==t||"no-interlace"==t?this.elements[t].set("checked",e):this.elements[t].set("value",e))},this)},getValue:function(){var t=this.element.toQueryString().parseQueryString();return e.serialize(t)}})}(),Brickrouge.Widget.PopThumbnailVersion=new Class({Extends:Brickrouge.Widget.Spinner,initialize:function(e,t){this.parent(e,t),this.control=this.element.getElement("input")},open:function(){this.resetValue=this.getValue(),this.popover?(this.popover.adjust.setValue(this.resetValue),this.popover.show()):new Request.Widget("adjust-thumbnail-version/popup",function(e){this.attachAdjust(e),this.popover.show(),this.popover.addEvent("action",this.onAction.bind(this))}.bind(this)).get({value:this.getValue()})},encodeValue:function(e){return console.log("encodeValue:",e),e},decodeValue:function(e){return console.log("decodeValue:",e),e},formatValue:function(e){return console.log("formatValue:",e),e},attachAdjust:function(e){this.popover=new Icybee.Widget.AdjustPopover(e,{anchor:this.element})},change:function(){},onAction:function(e){switch(e.action){case"use":this.setValue(e.popover.adjust.getValue());break;case"remove":this.setValue(null);break;case"cancel":this.setValue(this.resetValue)}this.popover.hide()}});