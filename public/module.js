var module;!function(){var e=new function(){this.RESIZE_NONE="none",this.RESIZE_FIT="fit",this.RESIZE_FILL="fill",this.RESIZE_FIXED_HEIGHT="fixed-height",this.RESIZE_FIXED_HEIGHT_CROPPED="fixed-height-cropped",this.RESIZE_FIXED_WIDTH="fixed-width",this.RESIZE_FIXED_WIDTH_CROPPED="fixed-width-cropped",this.RESIZE_SURFACE="surface",this.RESIZE_SIMPLE="simple",this.RESIZE_CONSTRAINED="constrained",this.assertSize=function(e,t,n){switch(n){case this.RESIZE_FIXED_WIDTH:if(!e)throw new Error("Width is required for the "+n+" resize method.");break;case this.RESIZE_FIXED_HEIGHT:if(!t)throw new Error("Height is required for the "+n+" resize method.");break;default:if(!e||!t)throw new Error("Both width and height are required for the "+n+" resize method.")}return!0}},t=function(){function e(e){var t={},n=e,r=e.indexOf("?");if(r>-1){n=e.substring(0,r);var a=e.substring(r+1);t=String.parseQueryString(a),t=i.widen(t)}t=Object.merge({width:null,height:null,method:null,format:null},t);var s=n.match(/\/?(\d+x\d+|\d+x|x\d+)(\/([^\/\.]+))?(\.([a-z]+))?/);if(s){var h=s[1].split("x"),l=h[0],o=h[1];l&&(t.width=parseInt(l)),o&&(t.height=parseInt(o)),s[3]&&(t.method=s[3]),s[5]&&(t.format=s[5]),t.format&&"jpg"==t.format&&(t.format="jpeg")}return Object.filter(t,function(e,t){return!!e})}var t={background:null,"default":null,filter:null,format:null,height:null,method:"fill","no-interlace":!1,"no-upscale":!1,overlay:null,path:null,quality:90,src:null,width:null},n={b:"background",d:"default",ft:"filter",f:"format",h:"height",m:"method",ni:"no-interlace",nu:"no-upscale",o:"overlay",p:"path",q:"quality",s:"src",v:"version",w:"width"},i=function(e){this.options=e};return i.prototype={toString:function(){return i.serialize(this.options)}},i.defaults=t,i.shorthands=n,i.widen=function(e){var t={},i=n;return Object.each(e,function(e,n){n in i&&(n=i[n]),t[n]=e}),t},i.shorten=function(e){var t={};return Object.each(e,function(e,i){var r=Object.keyOf(n,i);r&&(i=r),t[i]=e}),t},i.normalize=function(e){var i=t,r=Object.keys(i),a=n,s=Object.clone(i);Object.each(e,function(e,t){e&&(a[t]&&(t=a[t]),s[t]=e)});var h="method"in s?s.method:null,l="width"in s?s.width:null,o="height"in s?s.height:null;return l&&o&&!h?h="fill":l&&!o?h="fixed-width":!l&&o&&(h="fixed-height"),h?s.method=h:delete s.method,Object.filter(s,function(e,t){return Object.contains(r,t)})},i.filter=function(e){var n=t,r=i.normalize(e),a="width"in r?r.width:null,s="height"in r?r.height:null,h="method"in r?r.method:null;return(a&&s&&"fill"===h||a&&!s&&"fixed-width"===h||!a&&s&&"fixed-height"===h)&&delete r.method,Object.filter(r,function(e,t){return e&&e!=n[t]})},i.serialize=function(e){e=i.filter(e),e=i.shorten(e),e=Object.merge({w:"",h:"",m:null,f:null},e);var t="",n=e.w,r=e.h,a=e.m,s=e.f;(n||r)&&(t=n+"x"+r,a&&(t+="/"+a),s&&(t+="."+s)),delete e.w,delete e.h,delete e.m,delete e.f;var h=Object.toQueryString(e);return h&&(t+="?"+h),t},i.unserialize=function(t){var n=e(t);return n=i.filter(n)},i}(),n=new Class({options:{},initialize:function(e,t){this.src=e,this.options=t},toString:function(){var e=this.src,n=this.options,i=e.match(/repository\/files\/image\/(\d+)/)||e.match(/images\/(\d+|[a-z0-9\-]{36})/),r="/api/thumbnail";return"string"===typeOf(n)&&(n=t.unserialize(n)),i?r="/images/"+i[1]:n=Object.merge({src:e},n),r+"/"+t.serialize(n)}}),i={Image:e,Thumbnail:n,Version:t};module?module.exports=i:ICanBoogie.Modules.Thumbnailer=i}(),!function(e){e.Widget.AdjustThumbnailOptions=function(){var e=ICanBoogie.Modules.Thumbnailer.Version;return e.defaults.lightbox=null,e.shorthands.lb="lightbox",new Class({Implements:[Events],initialize:function(t){this.element=t=document.id(t),this.controls={},Object.each(e.defaults,function(e,n){var i=t.getElement('[name="'+n+'"]');i&&(this[n]=i)},this.controls),t.addEvent("change",this.onChange.bind(this)),this.checkMethod(),this.checkQuality()},checkMethod:function(){var e=this.controls.height,t=this.controls.width;switch(this.controls.method.get("value")){case"fixed-height":e.readOnly=!1,t.readOnly=!0;break;case"fixed-width":e.readOnly=!0,t.readOnly=!1;break;default:t.readOnly=!1,e.readOnly=!1}},checkQuality:function(){var e=this.controls.format.get("value");this.controls.quality.setStyle("display","jpeg"!=e?"none":""),this.controls.quality.previousSibling.setStyle("display","jpeg"!=e?"none":"")},getValue:function(){var e=this.element.toQueryString().parseQueryString();return this.controls.width.readOnly&&delete e.width,this.controls.height.readOnly&&delete e.height,e},setValue:function(t){Object.each(e.normalize(t),function(e,t){var n=this[t];n&&("checkbox"==n.type?n.set("checked",!!e):n.set("value",e))},this.controls),this.checkMethod(),this.checkQuality()},onChange:function(e){this.checkMethod(),this.checkQuality(),this.fireEvent("change",{target:this,values:this.getValue()})}})}(),e.register("AdjustThumbnailOptions",function(t,n){return new e.Widget.AdjustThumbnailOptions(t,n)})}(Brickrouge),!function(e){var t=ICanBoogie.Modules.Thumbnailer.Version;e.Widget.AdjustThumbnailVersion=new Class({Implements:[Options,Events],initialize:function(e,t){function n(){switch(s.get("value")){case"fixed-height":a.readOnly=!1,r.readOnly=!0;break;case"fixed-width":a.readOnly=!0,r.readOnly=!1;break;default:a.readOnly=!1,r.readOnly=!1}}function i(){var e=h.get("value");l.getParent().setStyle("display","jpeg"!=e?"none":"")}this.element=e=document.id(e);var r=e.getElement('input[name="width"]')||e.getElement('input[name$="[width]"]'),a=e.getElement('input[name="height"]')||e.getElement('input[name$="[height]"]'),s=e.getElement('select[name="method"]')||e.getElement('select[name$="[method]"]'),h=e.getElement('select[name="format"]')||e.getElement('select[name$="[format]"]'),l=e.getElement('input[name="quality"]')||e.getElement('input[name$="[quality]"]');this.elements={width:r,height:a,method:s,format:h,quality:l,"no-upscale":e.getElement('input[name="no-upscale"]')||e.getElement('input[name$="[no-upscale]"]'),background:e.getElement('input[name="background"]')||e.getElement('input[name$="[background]"]'),filter:e.getElement('input[name="filter"]')||e.getElement('input[name$="[filter]"]')},Object.each(this.elements,function(e){e&&e.addEvent("change",this.fireChange.bind(this))},this),n(),i(),s.addEvent("change",n),h.addEvent("change",i)},fireChange:function(){},setValue:function(e){var n=t.normalize(t.unserialize(e));Object.each(n,function(e,t){this.elements[t]&&("no-upscale"==t||"no-interlace"==t?this.elements[t].set("checked",e):this.elements[t].set("value",e))},this)},getValue:function(){var e=this.element.toQueryString().parseQueryString();return t.serialize(e)}}),e.register("AdjustThumbnailVersion",function(t,n){return new e.Widget.AdjustThumbnailVersion(t,n)})}(Brickrouge),!function(e){e.Widget.PopThumbnailVersion=new Class({Extends:e.Widget.Spinner,initialize:function(e,t){this.parent(e,t),this.control=this.element.getElement("input")},open:function(){this.resetValue=this.getValue(),this.popover?(this.popover.adjust.setValue(this.resetValue),this.popover.show()):new Request.Widget("adjust-thumbnail-version/popup",function(e){this.attachAdjust(e),this.popover.show(),this.popover.addEvent("action",this.onAction.bind(this))}.bind(this)).get({value:this.getValue()})},attachAdjust:function(e){this.popover=new Icybee.Widget.AdjustPopover(e,{anchor:this.element})},change:function(e){},onAction:function(e){switch(e.action){case"use":this.setValue(e.popover.adjust.getValue());break;case"remove":this.setValue(null);break;case"cancel":this.setValue(this.resetValue)}this.popover.hide()}}),e.register("PopThumbnailVersion",function(t,n){return new e.Widget.PopThumbnailVersion(t,n)})}(Brickrouge);